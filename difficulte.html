<!doctype html><html lang="fr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><title>ClimbTrack â€” DifficultÃ©</title><link rel="stylesheet" href="style.css"></head>
<body><div class="main-wrap"><div class="container"><div class="headerbar"><div class="logo">ğŸ§— <span class="highlight">DifficultÃ©</span></div><div class="right"><a class="btn green big" href="menu.html">ğŸ  Menu</a><a class="btn blue big" href="aide.html">â“ Aide</a></div></div>
<div class="card"><h2>Saisie</h2><p class="lead" id="idline"></p>
<label>Cotation<input id="d_cotation" placeholder="Ex. 5c, 6a+"></label>
<label>Relais atteint (X)<input id="d_relais" type="number" min="0" max="40" placeholder="Ex. 5"></label>
<label>Style<select id="d_style"><option value="moulinette">Moulinette</option><option value="en_tete">En tÃªte</option><option value="mouli_tete">Mouli-tÃªte</option></select></label>
<label>RÃ©sultat<select id="d_resultat"><option value="reussie">RÃ©ussie</option><option value="non_terminee">EssayÃ©e mais non terminÃ©e</option></select></label>
<div id="motifs" style="display:none;"><label>Motif<select id="d_motif"><option value="chute_degaine">Chute Ã  la dÃ©gaine (prÃ©ciser X)</option><option value="autre_prise">Autre prise (prÃ©ciser nb)</option><option value="fatigue">Fatigue</option><option value="peur">Peur</option><option value="technique">DifficultÃ© technique</option></select></label>
<div id="motif_deg" style="display:none;"><label>DÃ©gaine X<input id="d_degx" type="number" min="0" max="40" placeholder="Ex. 5"></label></div>
<div id="motif_nb" style="display:none;"><label>Nb. de prises<input id="d_nbprise" type="number" min="1" max="20" placeholder="Ex. 2"></label></div></div>
<div class="actions"><button class="btn blue big" id="btn-add">â• Ajouter</button><button class="btn red big" id="btn-clear">â™»ï¸ Vider</button></div>
<table class="table" id="d_table"><thead><tr><th>#</th><th>Cotation</th><th>Relais</th><th>Style</th><th>RÃ©sultat</th><th>Motif</th><th>Action</th></tr></thead><tbody></tbody></table>
<div class="actions"><button class="btn green big" id="btn-save">ğŸ’¾ Enregistrer sÃ©ance</button><button class="btn green big" id="btn-qr">ğŸ“· QR DifficultÃ©</button><a class="btn" href="seance.html">â¡ï¸ QR de sÃ©ance</a></div>
<div id="qr-section" style="display:none;margin-top:16px;"><h3>ğŸ“· QR prÃªt</h3><div class="qr-wrap"><div class="qr-box" id="qrd"></div><pre class="pre" id="jsond"></pre></div></div>
</div></div><footer><div class="container"><div class="footer-inner"></div></div></footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script type="module">
import {getIdentite,ensureIdentite,renderFooter,loadSeance,saveSeance,makeQR} from './app.js';renderFooter();ensureIdentite();const id=getIdentite();idline.innerHTML=`Ã‰lÃ¨ve : <strong>${id.Prenom} ${id.Nom}</strong> â€” <span class='badge'>Classe : ${id.Classe}</span>`;
const list=[],tbody=document.querySelector('#d_table tbody');const dres=d_resultat,motifs=document.getElementById('motifs'),motifSel=d_motif,motif_deg=document.getElementById('motif_deg'),motif_nb=document.getElementById('motif_nb');
function updateMotifFields(){const m=motifSel.value;motif_deg.style.display=(m==='chute_degaine')?'block':'none';motif_nb.style.display=(m==='autre_prise')?'block':'none';}
dres.addEventListener('change',()=>{motifs.style.display=(dres.value==='non_terminee')?'block':'none';updateMotifFields();});motifSel.addEventListener('change',updateMotifFields);
function render(){tbody.innerHTML='';list.forEach((it,i)=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${i+1}</td><td>${it.Cotation}</td><td>${it.Relais}</td><td>${it.Style}</td><td>${it.Resultat}</td><td>${it.MotifTxt||''}</td><td><button class="btn red" data-i="${i}">Supprimer</button></td>`;tbody.appendChild(tr);});tbody.querySelectorAll('button[data-i]').forEach(btn=>btn.addEventListener('click',e=>{list.splice(+e.currentTarget.dataset.i,1);render();}));}
function motifToTxt(m,degx,nbp){if(m==='chute_degaine')return 'degX'+(degx||'?');if(m==='autre_prise')return 'autre_prise:n'+(nbp||'?');if(m==='fatigue')return 'fatigue';if(m==='peur')return 'peur';if(m==='technique')return 'technique';return '';}
btn-add.onclick=()=>{const Cotation=d_cotation.value.trim(),Relais=parseInt(d_relais.value||'0',10),Style=d_style.value,Resultat=d_resultat.value;if(!Cotation){alert('Saisir une cotation');return;}const it={Cotation,Relais,Style,Resultat};it.MotifTxt=(Resultat==='non_terminee')?motifToTxt(motifSel.value,parseInt(d_degx.value||'0',10),parseInt(d_nbprise.value||'0',10)):'';list.push(it);render();};
btn-clear.onclick=()=>{list.length=0;render();};function itemToStr(it){return `${it.Cotation}|X${it.Relais}|${it.Style}|${it.Resultat==='reussie'?'OK':'NT:'+(it.MotifTxt||'')}`;}
btn-save.onclick=()=>{const s=loadSeance();s.difficulte=list.slice();saveSeance(s);alert('DifficultÃ© enregistrÃ©e âœ…');};
btn-qr.onclick=()=>{if(!list.length){alert('Ajoute une rÃ©alisation');return;}let cells=[id.Nom,id.Prenom,id.Classe];list.forEach((d,i)=>cells.push(`Diff${i+1}=${itemToStr(d)}`));const line=cells.join(',');makeQR('qrd',line);jsond.textContent=line;document.getElementById('qr-section').style.display='block';};
</script></body></html>
