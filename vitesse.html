<!doctype html><html lang="fr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><title>ClimbTrack â€” Vitesse</title><link rel="stylesheet" href="style.css"></head>
<body><div class="main-wrap"><div class="container"><div class="headerbar"><div class="logo">âš¡ <span class="highlight">Vitesse</span></div><div class="right"><a class="btn green big" href="menu.html">ğŸ  Menu</a><a class="btn blue big" href="aide.html">â“ Aide</a></div></div>
<div class="card"><h2>Essais & meilleur temps</h2><p class="lead" id="idline"></p>
<div class="row row-2"><div class="card"><h3>â±ï¸ Saisie manuelle</h3><div class="row row-3"><label>Minutes<input id="vm" type="number" min="0" max="59" placeholder="00"></label><label>Secondes<input id="vs" type="number" min="0" max="59" placeholder="00"></label><label>CentiÃ¨mes<input id="vc" type="number" min="0" max="99" placeholder="00"></label></div>
<div class="actions"><button class="btn blue big" id="btn-add">â• Ajouter essai</button><button class="btn red big" id="btn-clear">â™»ï¸ Vider essais</button></div></div>
<div class="card"><h3>â±ï¸ Chrono intÃ©grÃ© (option)</h3><p class="small">Uniquement si votre mur nâ€™a pas de chrono.</p><div style="font-size:2.2rem;font-weight:900;margin:10px 0;" id="vtimer">00:00.00</div>
<div class="actions"><button class="btn green big" id="vstart">Lancer</button><button class="btn amber big" id="vstop">Stop</button><button class="btn red big" id="vreset">RÃ©init</button><button class="btn blue big" id="btn-add-from-chrono">â• Ajouter depuis chrono</button></div></div></div>
<div class="card"><h3>Mes essais</h3><table class="table" id="v_table"><thead><tr><th>#</th><th>Temps</th><th>Action</th></tr></thead><tbody></tbody></table>
<p class="lead">Meilleur temps : <strong id="best"></strong> â€¢ Nb essais : <strong id="nb"></strong></p>
<div class="actions"><button class="btn green big" id="btn-save">ğŸ’¾ Enregistrer sÃ©ance</button><button class="btn green big" id="btn-qr">ğŸ“· QR Vitesse</button><a class="btn" href="seance.html">â¡ï¸ QR de sÃ©ance</a></div>
<div id="qr-section" style="display:none;margin-top:16px;"><h3>ğŸ“· QR prÃªt</h3><div class="qr-wrap"><div class="qr-box" id="qrv"></div><pre class="pre" id="jsonv"></pre></div></div>
</div></div><footer><div class="container"><div class="footer-inner"></div></div></footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script type="module">
import {getIdentite,ensureIdentite,renderFooter,formatTime,parseTimeToCentis,loadSeance,saveSeance,makeQR} from './app.js';renderFooter();ensureIdentite();const id=getIdentite();idline.innerHTML=`Ã‰lÃ¨ve : <strong>${id.Prenom} ${id.Nom}</strong> â€” <span class='badge'>Classe : ${id.Classe}</span>`;
const runs=[],tbody=document.querySelector('#v_table tbody'),bestEl=best,nbEl=nb;function render(){tbody.innerHTML='';let best=null;runs.forEach((it,i)=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${i+1}</td><td>${it.Temps}</td><td><button class="btn red" data-i="${i}">Supprimer</button></td>`;tbody.appendChild(tr);const v=parseTimeToCentis(it.Temps);if(best===null||v<best.val){best={val:v,txt:it.Temps};}});tbody.querySelectorAll('button[data-i]').forEach(btn=>btn.addEventListener('click',e=>{runs.splice(+e.currentTarget.dataset.i,1);render();}));bestEl.textContent=best?best.txt:'â€”';nbEl.textContent=runs.length;}
btn-add.onclick=()=>{const Temps=formatTime(vm.value,vs.value,vc.value);runs.push({Temps});render();};btn-clear.onclick=()=>{runs.length=0;render();};
let t0=0,raf=null,running=false;function tick(){const dt=Date.now()-t0,centi=Math.floor(dt/10)%100,sec=Math.floor(dt/1000)%60,min=Math.floor(dt/60000);vtimer.textContent=formatTime(min,sec,centi);if(running)raf=requestAnimationFrame(tick);}vstart.onclick=()=>{if(!running){running=true;t0=Date.now();raf=requestAnimationFrame(tick);}};vstop.onclick=()=>{if(!running)return;running=false;if(raf)cancelAnimationFrame(raf);};vreset.onclick=()=>{running=false;if(raf)cancelAnimationFrame(raf);vtimer.textContent='00:00.00';};btn-add-from-chrono.onclick=()=>{runs.push({Temps:vtimer.textContent});render();};
function bestAndCount(){if(!runs.length)return{best:null,count:0};let b=runs[0],bv=parseTimeToCentis(b.Temps);for(let i=1;i<runs.length;i++){const v=parseTimeToCentis(runs[i].Temps);if(v<bv){b=runs[i];bv=v;}}return {best:b.Temps,count:runs.length};}
btn-save.onclick=()=>{const s=loadSeance(),bc=bestAndCount();s.vitesse={runs:runs.slice(),best:bc.best,count:bc.count};saveSeance(s);alert('Vitesse enregistrÃ©e âœ…');};
btn-qr.onclick=()=>{if(!runs.length){alert('Ajoute un essai');return;}const bc=bestAndCount();let cells=[id.Nom,id.Prenom,id.Classe];runs.forEach((r,i)=>cells.push(`Essai${i+1}=${r.Temps}`));cells.push(`BestTemps=${bc.best||''}`,`NbEssais=${bc.count}`);const line=cells.join(',');makeQR('qrv',line);jsonv.textContent=line;document.getElementById('qr-section').style.display='block';};
</script></body></html>
